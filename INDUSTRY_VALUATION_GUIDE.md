# 行业特定估值参数使用指南

## 概述

系统现已支持根据不同行业特点自动调整估值参数，以提供更准确的估值分析。

## 功能特点

### 1. 自动行业识别
- 系统会自动获取股票的行业信息
- 根据行业关键词自动分类到预定义的9大行业类别

### 2. 行业分类

系统支持以下9种行业分类：

| 行业代码 | 行业名称 | 典型特征 |
|---------|---------|---------|
| utilities | 公用事业（电力/水务/燃气） | 现金流稳定，资本密集 |
| heavy_industry | 重工业（钢铁/化工/有色） | 资本密集，周期性强 |
| technology | 科技行业（软件/互联网/电子） | 轻资产，高成长 |
| finance | 金融行业（银行/证券/保险） | 特殊估值逻辑 |
| consumer | 消费行业（食品/零售/家电） | 需求稳定，稳定增长 |
| healthcare | 医药健康（医药/医疗器械） | 高成长，高壁垒 |
| real_estate | 房地产（地产/建筑） | 高杠杆，周期性强 |
| manufacturing | 制造业（机械/汽车/电气） | 中等资本密集 |
| services | 服务业（传媒/教育/旅游） | 轻资产 |

### 3. 行业特定参数

每个行业有独特的估值参数设置，主要包括：

#### 所有者收益法参数：
- **要求回报率** (required_return): 投资要求的最低回报率
- **安全边际** (margin_of_safety): 估值折扣比例
- **永续增长率上限** (terminal_growth_cap): 永续期增长率上限
- **维持性资本支出模式** (use_maintenance_capex): 是否只扣除维持性资本支出

#### DCF估值参数：
- **折现率** (discount_rate): 自由现金流折现率
- **永续增长率上限** (terminal_growth_cap): 永续期增长率上限

## 案例对比：长江电力（600900）

### 使用默认参数（修复前）：
- 要求回报率: 15%
- 安全边际: 25%
- 永续增长率: 3%
- 资本支出: 全额扣除
- **结果**: 所有者收益法估值仅¥119亿，与市值¥6,844亿相比Gap达-98.3%

### 使用公用事业参数（修复后）：
- 要求回报率: 10% ↓
- 安全边际: 15% ↓
- 永续增长率: 4% ↑
- 资本支出: 只扣除40%（维持性部分）
- **预期**: 估值大幅提升，Gap显著缩小

## 参数调整原理

### 公用事业行业（如长江电力）特殊处理：

1. **降低要求回报率**（15% → 10%）
   - 原因：现金流稳定，风险较低
   
2. **降低安全边际**（25% → 15%）
   - 原因：蓝筹股风险较低，不需要过高的折扣
   
3. **提高永续增长率**（3% → 4%）
   - 原因：公用事业长期稳定增长
   
4. **只扣除维持性资本支出**（100% → 40%）
   - 原因：电力企业资本支出中很大一部分是扩张性投资，而非维持运营必需
   - 这是解决Gap过大的关键因素

5. **降低折现率**（10% → 8%）
   - 原因：风险较低的公用事业应使用较低的折现率

## 技术实现

### 1. 配置文件位置
```
src/config/industry_valuation_params.py
```

### 2. 主要函数

```python
# 分类行业
industry_code = classify_industry("电力")  # 返回 "utilities"

# 获取行业参数
params = get_valuation_params("电力")

# 获取行业描述
desc = get_industry_description("utilities")  # 返回 "公用事业（电力/水务/燃气）"
```

### 3. 数据流

1. `get_stock_industry()` - 从数据源获取行业信息
2. `market_data_agent` - 将行业信息添加到state
3. `valuation_agent` - 根据行业选择参数并进行估值
4. 报告生成 - 显示使用的行业和参数

## 自定义参数

如需调整某个行业的参数，请编辑 `src/config/industry_valuation_params.py`：

```python
# 示例：修改公用事业行业参数
UTILITIES_PARAMS = {
    "owner_earnings": {
        "required_return": 0.10,       # 要求回报率
        "margin_of_safety": 0.15,      # 安全边际
        "terminal_growth_cap": 0.04,   # 永续增长率上限
        "use_maintenance_capex": True, # 只扣除维持性capex
        "maintenance_capex_ratio": 0.4,# 维持性capex占比
    },
    "dcf": {
        "discount_rate": 0.08,         # 折现率
        "terminal_growth_cap": 0.04,   # 永续增长率上限
    }
}
```

## 注意事项

1. 如果无法获取行业信息，系统会使用默认参数
2. 行业分类基于关键词匹配，可能需要根据实际情况调整
3. 参数设置基于一般性原则，特殊情况可能需要人工判断
4. 建议定期回顾和调整参数以适应市场变化

## 更新日志

- **2025-12-10**: 初始版本，支持9大行业分类
- 修复了长江电力等资本密集型公用事业企业估值偏差过大的问题
